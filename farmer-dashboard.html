<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Farmer Dashboard - FarmConnect</title>
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="css/farmer.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
    <!-- Navigation -->
    <nav class="navbar">
        <div class="container">
            <div class="nav-brand">
                <h1><i class="fas fa-tractor"></i> FarmConnect</h1>
                <span class="user-role">Farmer Dashboard</span>
            </div>
            <div class="nav-menu">
                <a href="#" class="nav-link active" onclick="showSection('dashboard')">
                    <i class="fas fa-home"></i> Dashboard
                </a>
                <a href="#" class="nav-link" onclick="showSection('products')">
                    <i class="fas fa-apple-alt"></i> My Products
                </a>
                <a href="#" class="nav-link" onclick="showSection('addProduct')">
                    <i class="fas fa-plus-circle"></i> Add Product
                </a>
                <a href="#" class="nav-link" onclick="showSection('orders')">
                    <i class="fas fa-shopping-cart"></i> Orders
                </a>
                <a href="#" class="nav-link" onclick="showSection('messages')">
                    <i class="fas fa-comments"></i> Messages
                </a>
                <div class="user-info">
                    <span id="userName">Loading...</span>
                    <div class="user-dropdown">
                        <a href="#" onclick="showSection('profile')"><i class="fas fa-user"></i> Profile</a>
                        <a href="#" onclick="logout()"><i class="fas fa-sign-out-alt"></i> Logout</a>
                    </div>
                </div>
            </div>
        </div>
    </nav>

    <!-- Dashboard Content -->
    <div class="container main-content">
        <!-- Dashboard Overview -->
        <section id="dashboardSection" class="section active">
            <div class="dashboard-header">
                <h2><i class="fas fa-chart-line"></i> Dashboard Overview</h2>
                <p>Welcome back, <span id="farmerName"></span>! Here's your farming summary.</p>
            </div>
            
            <div class="stats-cards">
                <div class="stat-card">
                    <div class="stat-icon income">
                        <i class="fas fa-rupee-sign"></i>
                    </div>
                    <div class="stat-content">
                        <h3>Total Earnings</h3>
                        <p class="stat-value" id="totalEarnings">₹0</p>
                        <span class="stat-change" id="earningsChange">+0% this month</span>
                    </div>
                </div>
                
                <div class="stat-card">
                    <div class="stat-icon products">
                        <i class="fas fa-apple-alt"></i>
                    </div>
                    <div class="stat-content">
                        <h3>Active Products</h3>
                        <p class="stat-value" id="activeProducts">0</p>
                        <span class="stat-change" id="productsChange">0 listed</span>
                    </div>
                </div>
                
                <div class="stat-card">
                    <div class="stat-icon orders">
                        <i class="fas fa-shopping-cart"></i>
                    </div>
                    <div class="stat-content">
                        <h3>Pending Orders</h3>
                        <p class="stat-value" id="pendingOrders">0</p>
                        <span class="stat-change" id="ordersChange">0 new today</span>
                    </div>
                </div>
                
                <div class="stat-card">
                    <div class="stat-icon rating">
                        <i class="fas fa-star"></i>
                    </div>
                    <div class="stat-content">
                        <h3>Your Rating</h3>
                        <p class="stat-value" id="farmerRating">0.0</p>
                        <span class="stat-change" id="ratingChange">based on 0 reviews</span>
                    </div>
                </div>
            </div>
            
            <div class="dashboard-grid">
                <div class="dashboard-card">
                    <h3><i class="fas fa-chart-bar"></i> Recent Orders</h3>
                    <div class="recent-orders" id="recentOrders">
                        <p>Loading orders...</p>
                    </div>
                </div>
                
                <div class="dashboard-card">
                    <h3><i class="fas fa-money-bill-wave"></i> Market Price Updates</h3>
                    <div class="market-prices" id="marketPrices">
                        <p>Loading market prices...</p>
                    </div>
                </div>
                
                <div class="dashboard-card">
                    <h3><i class="fas fa-bullhorn"></i> Quick Actions</h3>
                    <div class="quick-actions">
                        <button class="action-btn" onclick="showSection('addProduct')">
                            <i class="fas fa-plus"></i> Add New Product
                        </button>
                        <button class="action-btn" onclick="showSection('products')">
                            <i class="fas fa-edit"></i> Manage Products
                        </button>
                        <button class="action-btn" onclick="showSection('messages')">
                            <i class="fas fa-comments"></i> Check Messages
                        </button>
                        <button class="action-btn" onclick="updateProfile()">
                            <i class="fas fa-user-edit"></i> Update Profile
                        </button>
                    </div>
                </div>
            </div>
        </section>

        <!-- My Products Section -->
        <section id="productsSection" class="section">
            <div class="section-header">
                <h2><i class="fas fa-apple-alt"></i> My Products</h2>
                <button class="btn btn-primary" onclick="showSection('addProduct')">
                    <i class="fas fa-plus"></i> Add New Product
                </button>
            </div>
            
            <div class="products-filters">
                <select id="productFilter" onchange="filterProducts()">
                    <option value="all">All Products</option>
                    <option value="available">Available Only</option>
                    <option value="sold">Sold Out</option>
                </select>
                <input type="text" id="productSearch" placeholder="Search products..." onkeyup="searchProducts()">
            </div>
            
            <div class="products-grid" id="productsGrid">
                <!-- Products will be loaded here -->
                <div class="loading">Loading products...</div>
            </div>
        </section>

        <!-- Add Product Section -->
        <section id="addProductSection" class="section">
            <div class="section-header">
                <h2><i class="fas fa-plus-circle"></i> Add New Product</h2>
                <button class="btn btn-outline" onclick="showSection('products')">
                    <i class="fas fa-arrow-left"></i> Back to Products
                </button>
            </div>
            
            <div class="add-product-container">
                <div class="add-product-form">
                    <form id="productForm">
                        <div class="form-row">
                            <div class="form-group">
                                <label for="productName">Product Name *</label>
                                <input type="text" id="productName" required placeholder="e.g., Tomato, Rice, Mango">
                            </div>
                            <div class="form-group">
                                <label for="productCategory">Category *</label>
                                <select id="productCategory" required>
                                    <option value="">Select Category</option>
                                    <option value="vegetables">Vegetables</option>
                                    <option value="fruits">Fruits</option>
                                    <option value="grains">Grains</option>
                                    <option value="dairy">Dairy</option>
                                    <option value="poultry">Poultry</option>
                                    <option value="others">Others</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label for="quantityValue">Quantity *</label>
                                <div class="quantity-input">
                                    <input type="number" id="quantityValue" min="1" required placeholder="100">
                                    <select id="quantityUnit">
                                        <option value="kg">kg</option>
                                        <option value="quintal">Quintal</option>
                                        <option value="ton">Ton</option>
                                        <option value="litre">Litre</option>
                                        <option value="piece">Piece</option>
                                        <option value="dozen">Dozen</option>
                                    </select>
                                </div>
                            </div>
                            <div class="form-group">
                                <label for="qualityGrade">Quality Grade</label>
                                <select id="qualityGrade">
                                    <option value="regular">Regular</option>
                                    <option value="grade-a">Grade A</option>
                                    <option value="grade-b">Grade B</option>
                                    <option value="organic">Organic</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="price-section">
                            <h3><i class="fas fa-tag"></i> Pricing</h3>
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="pricePerUnit">Your Price (₹ per unit) *</label>
                                    <input type="number" id="pricePerUnit" min="1" required placeholder="30">
                                </div>
                                <div class="form-group">
                                    <label>Market Price</label>
                                    <div class="market-price-display">
                                        <span id="marketPriceValue">₹0</span>
                                        <small>per unit</small>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="price-comparison">
                                <div class="comparison-card">
                                    <h4>Your Price</h4>
                                    <p id="yourPriceDisplay">₹0/unit</p>
                                </div>
                                <div class="comparison-card">
                                    <h4>Market Average</h4>
                                    <p id="marketAverageDisplay">₹0/unit</p>
                                </div>
                                <div class="comparison-card">
                                    <h4>Price Advice</h4>
                                    <p id="priceAdvice" class="advice-neutral">Enter product name</p>
                                </div>
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label for="productDescription">Description</label>
                            <textarea id="productDescription" rows="3" placeholder="Describe your product..."></textarea>
                        </div>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label for="harvestDate">Harvest Date</label>
                                <input type="date" id="harvestDate">
                            </div>
                            <div class="form-group">
                                <label for="productTags">Tags</label>
                                <input type="text" id="productTags" placeholder="fresh, organic, premium (comma separated)">
                            </div>
                        </div>
                        
                        <div class="form-actions">
                            <button type="button" class="btn btn-outline" onclick="showSection('products')">Cancel</button>
                            <button type="submit" class="btn btn-primary">
                                <i class="fas fa-save"></i> Add Product
                            </button>
                        </div>
                    </form>
                </div>
                
                <div class="add-product-guide">
                    <h3><i class="fas fa-lightbulb"></i> Tips for Better Sales</h3>
                    <ul>
                        <li><strong>Set competitive prices:</strong> Check market prices before setting your price</li>
                        <li><strong>Clear descriptions:</strong> Mention quality, freshness, and special features</li>
                        <li><strong>Freshness matters:</strong> Update harvest date for better buyer trust</li>
                        <li><strong>Use tags:</strong> Help buyers find your products easily</li>
                        <li><strong>Respond quickly:</strong> Buyers appreciate timely responses</li>
                    </ul>
                    
                    <div class="market-tips">
                        <h4><i class="fas fa-chart-line"></i> Today's Market Trends</h4>
                        <div id="marketTips">
                            <p>Loading market trends...</p>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Orders Section -->
        <section id="ordersSection" class="section">
            <div class="section-header">
                <h2><i class="fas fa-shopping-cart"></i> My Orders</h2>
                <div class="order-filters">
                    <select id="orderStatusFilter" onchange="filterOrders()">
                        <option value="all">All Orders</option>
                        <option value="pending">Pending</option>
                        <option value="confirmed">Confirmed</option>
                        <option value="shipped">Shipped</option>
                        <option value="delivered">Delivered</option>
                        <option value="cancelled">Cancelled</option>
                    </select>
                </div>
            </div>
            
            <div class="orders-container" id="ordersContainer">
                <!-- Orders will be loaded here -->
                <div class="loading">Loading orders...</div>
            </div>
        </section>

        <!-- Messages Section -->
        <section id="messagesSection" class="section">
            <div class="section-header">
                <h2><i class="fas fa-comments"></i> Messages</h2>
                <button class="btn btn-primary" onclick="startNewChat()">
                    <i class="fas fa-plus"></i> New Message
                </button>
            </div>
            
            <div class="chat-container">
                <div class="chat-sidebar">
                    <div class="chat-search">
                        <input type="text" placeholder="Search conversations..." id="chatSearch">
                    </div>
                    <div class="chat-list" id="chatList">
                        <!-- Chat list will be loaded here -->
                        <div class="no-chats">No messages yet</div>
                    </div>
                </div>
                
                <div class="chat-main">
                    <div class="chat-header" id="chatHeader">
                        <div class="no-chat-selected">
                            <i class="fas fa-comments"></i>
                            <h3>Select a conversation</h3>
                            <p>Choose a chat from the list or start a new one</p>
                        </div>
                    </div>
                    
                    <div class="chat-messages" id="chatMessages">
                        <!-- Messages will be loaded here -->
                    </div>
                    
                    <div class="chat-input" id="chatInput" style="display: none;">
                        <input type="text" placeholder="Type your message..." id="messageInput">
                        <button onclick="sendMessage()">
                            <i class="fas fa-paper-plane"></i>
                        </button>
                    </div>
                </div>
            </div>
        </section>

        <!-- Profile Section -->
        <section id="profileSection" class="section">
            <div class="section-header">
                <h2><i class="fas fa-user"></i> My Profile</h2>
                <button class="btn btn-primary" onclick="editProfile()">
                    <i class="fas fa-edit"></i> Edit Profile
                </button>
            </div>
            
            <div class="profile-container">
                <div class="profile-sidebar">
                    <div class="profile-avatar">
                        <img src="https://ui-avatars.com/api/?name=FarmConnect&background=2c8c3a&color=fff&size=150" 
                             alt="Profile" id="profileImage">
                        <button class="btn-change-image">Change Photo</button>
                    </div>
                    
                    <div class="profile-stats">
                        <h3>Account Stats</h3>
                        <div class="stat-item">
                            <span class="stat-label">Member Since</span>
                            <span class="stat-value" id="memberSince">2023</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-label">Total Products</span>
                            <span class="stat-value" id="totalProductsStat">0</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-label">Total Orders</span>
                            <span class="stat-value" id="totalOrdersStat">0</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-label">Success Rate</span>
                            <span class="stat-value" id="successRate">0%</span>
                        </div>
                    </div>
                </div>
                
                <div class="profile-main">
                    <div class="profile-info">
                        <h3>Personal Information</h3>
                        <div class="info-grid">
                            <div class="info-item">
                                <label>Full Name</label>
                                <p id="profileName">Loading...</p>
                            </div>
                            <div class="info-item">
                                <label>Username</label>
                                <p id="profileUsername">Loading...</p>
                            </div>
                            <div class="info-item">
                                <label>Mobile Number</label>
                                <p id="profileMobile">Loading...</p>
                            </div>
                            <div class="info-item">
                                <label>Account Type</label>
                                <p class="role-badge farmer">Farmer</p>
                            </div>
                            <div class="info-item">
                                <label>Location</label>
                                <p id="profileLocation">Not specified</p>
                            </div>
                            <div class="info-item">
                                <label>Rating</label>
                                <div class="rating-display">
                                    <span class="stars">★★★★★</span>
                                    <span id="profileRating">0.0/5.0</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="profile-actions">
                        <h3>Account Settings</h3>
                        <div class="action-buttons">
                            <button class="action-btn" onclick="changePassword()">
                                <i class="fas fa-key"></i> Change Password
                            </button>
                            <button class="action-btn" onclick="updateLocation()">
                                <i class="fas fa-map-marker-alt"></i> Update Location
                            </button>
                            <button class="action-btn" onclick="verifyAccount()">
                                <i class="fas fa-badge-check"></i> Verify Account
                            </button>
                            <button class="action-btn btn-danger" onclick="deleteAccount()">
                                <i class="fas fa-trash"></i> Delete Account
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </section>
    </div>

    <!-- Modal for Product Details -->
    <div id="productModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal()">&times;</span>
            <div id="modalBody"></div>
        </div>
    </div>

    <!-- Socket.io -->
    <script src="/socket.io/socket.io.js"></script>
    <script src="js/common.js"></script>
    <script src="js/farmer.js"></script>
</body>
</html>